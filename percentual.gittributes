CREATE TABLE PRODUTO( 
   ID NUMBER(4) PRIMARY KEY, 
   NOME VARCHAR2(120) NOT NULL, 
   PRECO NUMBER(6,2) NOT NULL,
   CONSTRAINT UQ_NOME_PRODUTO UNIQUE (NOME) 
); 
INSERT INTO PRODUTO (ID, NOME, PRECO) VALUES (1, 'Caneta', 2.50); 
INSERT INTO PRODUTO (ID, NOME, PRECO) VALUES (2, 'Papel', 12.30); 
INSERT INTO PRODUTO (ID, NOME, PRECO) VALUES (3, 'Borracha', 0.45); 
INSERT INTO PRODUTO (ID, NOME, PRECO) VALUES (4, 'Lápis', 1.50); 
INSERT INTO PRODUTO (ID, NOME, PRECO) VALUES (5, 'Pincel', 6); 
COMMIT;

CREATE OR REPLACE FUNCTION FUNC_AUMENTOPRECOPRODUTO (P_IDPROD IN NUMBER, P_PERC IN NUMBER)
RETURN NUMBER
IS
   RET NUMBER(3) := 0;
   V_QTDE NUMBER(1);
BEGIN
   IF P_IDPROD > 0 AND P_IDPROD <= 9999 THEN
      IF P_PERC > 0 AND P_PERC <= 15 THEN
         SELECT COUNT(*) INTO V_QTDE FROM PRODUTO WHERE ID = P_IDPROD;
         IF V_QTDE = 1 THEN
            UPDATE PRODUTO SET PRECO = PRECO + (PRECO * (P_PERC/100))
                WHERE ID = P_IDPROD;
            RET := 0;
         ELSE
            RET := -999; -- ID PRODUTO FORA DA FAIXA, ENTÃO NÃO ENCONTRADO
         END IF;
      ELSE
         RET := -998; -- PERCENTUAL FORA DA FAIXA DE VALOR PERMITIDO
      END IF;
   ELSE
   RET := -999; -- ID PRODUTO FORA DA FAIXA, ENTÃO NÃO ENCONTRADO
   END IF;
   COMMIT;
   RETURN RET;
EXCEPTION
   WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('CODIGO DO ERRO: ' || SQLCODE);
      DBMS_OUTPUT.PUT_LINE('DESCRICAO DO ERRO: ' || SQLERRM);
      RETURN SQLCODE;
END;




---CASO DE TESTE 1
DECLARE
   X NUMBER(4);
BEGIN
   X := FUNC_AUMENTOPRECOPRODUTO(4, 12);
   DBMS_OUTPUT.PUT_LINE('RESULTADO DA EXECUÇÃO DA FUNÇÃO: ' || X);
END;

---CASO DE TESTE 2
DECLARE
   X NUMBER(4);
BEGIN
   X := FUNC_AUMENTOPRECOPRODUTO(3, 2.32);
   DBMS_OUTPUT.PUT_LINE('RESULTADO DA EXECUÇÃO DA FUNÇÃO: ' || X);
END;

---CASO DE TESTE 3
DECLARE
   X NUMBER(4);
BEGIN
   X := FUNC_AUMENTOPRECOPRODUTO(2, 20);
   DBMS_OUTPUT.PUT_LINE('RESULTADO DA EXECUÇÃO DA FUNÇÃO: ' || X);
END;

---CASO DE TESTE 4
DECLARE
   X NUMBER(4);
BEGIN
   X := FUNC_AUMENTOPRECOPRODUTO(9, 10);
   DBMS_OUTPUT.PUT_LINE('RESULTADO DA EXECUÇÃO DA FUNÇÃO: ' || X);
END;


SELECT * FROM PRODUTO;
